{% extends "network/layout.html" %}
{% load static %}
{% load i18n %}

{% block title %}
    Post by @{{ post.user.username }}
    <!-- TODO figure out how to translate this -->
{% endblock %}

{% block body %}
    <!-- DO NOT DELETE! THIS IS USED IN USER.JS -->
    <div id="user-id" style="display: none">{{ post.user.id }}</div>
    <!-- END DO NOT DELETE -->

    <div id="single-post-outer">
        <!-- maybe put a smaller version of the entire post we're replying to in here? -->
        
        <div id="single-post-view-container">
            {% if post.reply_to != None %}
            <div class="post-reply-to-div" id="single-post-view-reply-to-div">
                <a class="post-reply-to-link" href="{% url 'post' post.reply_to.id %}">
                    Reply to @{{ post.reply_to.user }}: {{ post.reply_to.text }}
                </a>
            </div>
            {% endif %}
            <div id="single-post-view-avatar">
                <a href="{% url 'user' post.user.username %}">
                    <img class="profile-pic" src="{{ post.user.avatar.url }}">
                </a>
            </div>
            <div id="single-post-view-name-div">
                <a href="{% url 'user' post.user.username %}">
                    <div id="user-profile-displayname">{{ post.user.displayname }}</div>
                </a>
                <a href="{% url 'user' post.user.username %}">
                    <div id="user-profile-username">@{{ post.user.username }}</div>
                </a>
            </div>
            <div id="single-post-view-follow-div">
                {% if user.is_authenticated and user != post.user %}
                    <div id="follow-button-div">
                        {% if post.user in user.following.all %}
                            <button id="unfollow-button">{% trans 'Unfollow' %}</button>
                        {% else %}
                            <button id="follow-button">{% trans 'Follow' %}</button>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            <div id="post-text-{{ post.id }}" class="single-post-view-text-div">{{ post.text }}</div>
            {% if post.image %}
                <div id="single-post-view-image-div">
                    <img class="post-image" src="{{ post.image.url }}">
                </div>
            {% endif %}
            <div id="single-post-view-timestamp-div">
                {{ post.timestamp }} UTC
            </div>
            {% if user.is_authenticated and post.user != user %}
                <div class="post-like-button-div single-post-view-like-button-div" id="post-like-button-div-{{ post.id }}">
                    {% if post in user.liked_posts.all %}
                        <button class="post-unlike-button single-page-like-button" id="post-like-button-{{ post.id }}">
                            <div id="post-like-heart-{{ post.id }}" class="post-like-heart-liked">
                                ❤️
                            </div>
                            <div id="post-like-count-{{ post.id }}" class="post-like-count">
                                {{ post.users_who_liked.count }}
                            </div>
                        </button>
                    {% else %}
                        <button class="post-like-button single-page-like-button" id="post-like-button-{{ post.id }}">
                            <div id="post-like-heart-{{ post.id }}" class="post-like-heart-unliked">
                                ‍♡ 
                            </div>
                            <div id="post-like-count-{{ post.id }}" class="post-like-count">
                                {{ post.users_who_liked.count }}
                            </div>
                        </button>
                    {% endif %}
                </div>
            {% else %}
                <div class="post-like-button-div" id="post-like-button-div-{{ post.id }}">
                    <div class="post-like-button-inactive single-page-like-button">
                        <div class="post-like-heart-unliked">
                            <i class="far fa-heart"></i>
                        </div>
                        <div class="post-like-count">
                            {{ post.users_who_liked.count }}
                        </div>
                    </div>
                </div>
            {% endif %}
            <div id="single-post-view-like-edit-div">
                {% if user.is_authenticated %}
                    <div class="post-interaction-div-right">
                        <!-- edit button -->
                        {% if post.user == user %}
                            <div class="post-bottom-row-right-div">
                                <div hidden class="post-edit-cancel-button" id="ecb-{{ post.id }}"><i class="fas fa-times"></i></div>
                                <div class="post-edit-button" id="eb-{{ post.id }}"><i class="far fa-edit"></i></div>
                            </div>
                        {% endif %}
                        <div class="post-bottom-row-right-div">
                            <div hidden class="post-reply-cancel-button btn-minw-small" id="rcb-{{ post.id }}"><i class="fas fa-times"></i></div>
                            <div class="post-reply-button btn-minw-small" id="rb-{{ post.id }}"><i class="far fa-comment-dots"></i></i></div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

    </div>

    <!-- reply box -->
    <div class="margin-fix">
        <div id="prslide-{{ post.id }}" class="prslide">
            <div hidden class="post-reply-div" id="prd-{{ post.id }}">
                <textarea class="post-reply-input" id="pri-{{ post.id }}">@{{ post.user.username }} </textarea>
                <div class="flex-row-end">
                    <button class="post-reply-submit submit-button" id="prs-{{ post.id }}">Reply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- replies header -->
    {% if post.replies.count > 0 %}
        <div class="section-identifier">
            <div class="section-identifier-inner">
                {{ post.replies.count }} replies
            </div>
        </div>

        <!-- replies -->
        {% include 'network/posts.html' %}
    {% endif %}

{% endblock %}

{% block script %}
    {% if user.is_authenticated %}<script src="{% static 'network/posts-loggedin.js' %}"></script>{% endif %}
    <script src="{% static 'network/user.js' %}"></script>
    <script src="{% static 'network/posts.js' %}"></script>
    <script src="{% static 'network/utils.js' %}"></script>
{% endblock %}
